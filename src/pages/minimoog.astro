---
// Minimoog App Page - Embeds the Minimoog synthesizer as an iframe
import Layout from "../components/Layout.astro";
---

<Layout
  title="Minimoog Synthesizer - Steve Barakat"
  description="Experience the classic Minimoog synthesizer in your browser. A vintage-inspired digital synthesizer built with React and Web Audio API."
>
  <section class="page-header">
    <h1>Minimoog Synthesizer</h1>
    <p>
      Experience the classic Minimoog sound in your browser. A vintage-inspired
      digital synthesizer built with React and Web Audio API, featuring full
      waveform control and real-time audio synthesis.
    </p>
  </section>

  <div class="iframe-wrapper">
    <div class="loading">Loading Minimoog Synthesizer...</div>
    <iframe
      src="https://minimoog.stevebarakat.com/"
      class="minimoog-iframe"
      title="Minimoog Synthesizer App"
      allow="microphone; camera; midi; encrypted-media"
      sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-modals"
    ></iframe>
  </div>

  <div class="app-info">
    <h2>About the Minimoog App</h2>
    <p>
      This digital recreation of the classic Minimoog synthesizer brings the
      iconic sound of the 1970s into the modern web browser. Built with
      cutting-edge web technologies, it provides an authentic synthesizer
      experience with real-time audio synthesis.
    </p>

    <div class="features">
      <div class="feature">
        <h3>üéπ Full Keyboard Support</h3>
        <p>
          Play with your computer keyboard or connect a MIDI controller for the
          full experience.
        </p>
      </div>
      <div class="feature">
        <h3>üéõÔ∏è Classic Controls</h3>
        <p>
          Authentic Minimoog-style knobs and sliders for waveform, filter, and
          envelope control.
        </p>
      </div>
      <div class="feature">
        <h3>üéµ Real-time Synthesis</h3>
        <p>
          Web Audio API-powered synthesis with low latency and high-quality
          sound generation.
        </p>
      </div>
      <div class="feature">
        <h3>üíæ Preset System</h3>
        <p>
          Save and load your favorite patches, or try the included classic
          Minimoog presets.
        </p>
      </div>
    </div>
  </div>

  <script>
    // Add loading state management
    const iframe = document.querySelector(
      ".minimoog-iframe"
    ) as HTMLIFrameElement;
    const loading = document.querySelector(".loading") as HTMLElement;

    if (iframe && loading) {
      iframe.addEventListener("load", () => {
        loading.style.display = "none";

        // Try to set iframe body background to none
        try {
          const iframeDoc =
            iframe.contentDocument || iframe.contentWindow?.document;
          if (iframeDoc) {
            const iframeBody = iframeDoc.querySelector("body");
            if (iframeBody) {
              iframeBody.style.background = "none";
            }
          }
        } catch (error) {
          // Cross-origin restrictions or other errors
          console.log("Could not access iframe document:", error);
        }
      });

      iframe.addEventListener("error", () => {
        loading.textContent =
          "Error loading Minimoog app. Please try refreshing the page.";
      });
    }
  </script>
</Layout>
